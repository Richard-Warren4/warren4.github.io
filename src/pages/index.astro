---
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import NewsletterSignup from '../components/NewsletterSignup.astro';
import SkipLink from '../components/SkipLink.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const allPosts = await getCollection('blog');

// Featured posts
const featuredPostIds = ['the-ai-pm-operating-system'];
const featuredPosts = allPosts
  .filter((post) => featuredPostIds.includes(post.id))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 1);

// Recent posts
const posts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      /* Hero */
      .hero {
        max-width: 900px;
        margin: 0 auto;
        padding: 3rem 1.5rem 2rem;
        text-align: center;
        position: relative;
      }

      .hero-badge {
        display: inline-block;
        background: var(--pop-3);
        color: var(--text);
        padding: 0.5rem 1.25rem;
        border-radius: 100px;
        font-weight: 600;
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
        transform: rotate(-2deg);
        box-shadow: 3px 3px 0 var(--text);
      }

      .hero h1 {
        font-size: 3.5rem;
        font-weight: 700;
        line-height: 1.1;
        margin-bottom: 1.5rem;
      }

      .hero h1 .highlight {
        position: relative;
        display: inline;
      }

      .hero h1 .highlight::after {
        content: '';
        position: absolute;
        bottom: 4px;
        left: -4px;
        right: -4px;
        height: 30%;
        background: var(--pop-3);
        z-index: -1;
        transform: rotate(-1deg);
      }

      .hero h1 .wiggle {
        display: inline-block;
        animation: wiggle 3s ease-in-out infinite;
      }

      @keyframes wiggle {
        0%, 100% { transform: rotate(-3deg); }
        50% { transform: rotate(3deg); }
      }

      .hero-subtitle {
        font-size: 1.35rem;
        color: var(--text-muted);
        max-width: 600px;
        margin: 0 auto 2rem;
        line-height: 1.6;
      }

      .hero-subtitle .handwriting {
        color: var(--pop);
      }

      .hero-cta {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: var(--text);
        color: var(--bg);
        padding: 1rem 2rem;
        border-radius: 100px;
        text-decoration: none;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.2s;
        box-shadow: 4px 4px 0 var(--pop);
      }

      .hero-cta:hover {
        transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 var(--pop);
        text-decoration: none;
        color: var(--bg);
      }

      .hero-doodle {
        position: absolute;
        font-size: 1.75rem;
        opacity: 0.7;
        pointer-events: none;
      }
      .hero-doodle.d1 { top: 5%; left: 5%; transform: rotate(-15deg); }
      .hero-doodle.d2 { top: 15%; right: 3%; transform: rotate(10deg); }
      .hero-doodle.d3 { bottom: 25%; left: 2%; transform: rotate(-5deg); }
      .hero-doodle.d4 { bottom: 20%; right: 8%; transform: rotate(15deg); }

      /* Topics */
      .topics {
        max-width: 900px;
        margin: 0 auto;
        padding: 1rem 1.5rem 2rem;
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
      }

      .topic-tag {
        background: white;
        border: 3px solid var(--text);
        border-radius: 100px;
        padding: 0.6rem 1.25rem;
        font-weight: 600;
        font-size: 0.95rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s;
        cursor: default;
      }

      .topic-tag:nth-child(1) { transform: rotate(-2deg); }
      .topic-tag:nth-child(2) { transform: rotate(1deg); }
      .topic-tag:nth-child(3) { transform: rotate(-1deg); }

      .topic-tag:hover { transform: rotate(0deg) scale(1.05); }
      .topic-tag:nth-child(1):hover { background: var(--pop); color: white; border-color: var(--pop); }
      .topic-tag:nth-child(2):hover { background: var(--pop-2); color: white; border-color: var(--pop-2); }
      .topic-tag:nth-child(3):hover { background: var(--pop-4); border-color: var(--pop-4); }

      /* Sections */
      .section {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2rem 1.5rem;
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .section-header h2 {
        font-size: 1.75rem;
        position: relative;
      }

      .section-header h2::after {
        content: '';
        display: block;
        width: 60%;
        height: 4px;
        background: var(--pop-2);
        margin-top: 0.4rem;
        border-radius: 2px;
      }

      .section-header a {
        color: var(--pop);
        text-decoration: none;
        font-weight: 600;
        border-bottom: 2px dashed var(--pop);
      }

      .section-header a:hover {
        text-decoration: none;
        border-bottom-style: solid;
      }

      /* Featured Post */
      .featured-post {
        background: white;
        border: 3px solid var(--text);
        border-radius: 20px;
        overflow: hidden;
        display: grid;
        grid-template-columns: 1.1fr 1fr;
        box-shadow: 6px 6px 0 var(--text);
        transition: all 0.3s;
      }

      .featured-post:hover {
        transform: translate(-2px, -2px);
        box-shadow: 10px 10px 0 var(--text);
      }

      .featured-image {
        background: linear-gradient(135deg, var(--pop-3) 0%, var(--pop) 100%);
        min-height: 320px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 5rem;
        position: relative;
      }

      .featured-image::before {
        content: '"';
        position: absolute;
        top: 15px;
        left: 25px;
        font-size: 7rem;
        opacity: 0.2;
        font-family: Georgia, serif;
      }

      .featured-content {
        padding: 2.5rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .post-tag {
        display: inline-block;
        background: var(--pop-2);
        color: white;
        padding: 0.3rem 0.9rem;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 1rem;
        width: fit-content;
      }

      .featured-content h3 {
        font-size: 1.65rem;
        font-weight: 700;
        line-height: 1.3;
        margin-bottom: 1rem;
      }

      .featured-content h3 a {
        color: var(--text);
        text-decoration: none;
      }

      .featured-content h3 a:hover {
        text-decoration: underline;
        text-decoration-style: wavy;
        text-underline-offset: 4px;
      }

      .featured-content > p {
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        line-height: 1.7;
      }

      .read-time {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .read-time .handwriting {
        color: var(--pop);
      }

      /* Posts Grid */
      .posts-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .post-card {
        background: white;
        border: 3px solid var(--text);
        border-radius: 16px;
        padding: 1.5rem;
        transition: all 0.2s;
        position: relative;
      }

      .post-card::before {
        content: '';
        position: absolute;
        top: -8px;
        right: 18px;
        width: 36px;
        height: 14px;
        background: var(--pop-3);
        border-radius: 2px;
        transform: rotate(-4deg);
      }

      .post-card:nth-child(2)::before { background: var(--pop-2); }
      .post-card:nth-child(3)::before { background: var(--pop-4); }

      .post-card:hover {
        transform: translateY(-4px) rotate(-1deg);
        box-shadow: 5px 5px 0 var(--text);
      }

      .post-card a {
        text-decoration: none;
        display: block;
      }

      .post-card h3 {
        font-size: 1.1rem;
        font-weight: 600;
        line-height: 1.4;
        margin: 0.75rem 0;
        color: var(--text);
      }

      .post-card a:hover h3 {
        text-decoration: underline;
        text-decoration-style: wavy;
        text-underline-offset: 3px;
      }

      .post-card .description {
        font-size: 0.95rem;
        color: var(--text-muted);
        line-height: 1.55;
        margin: 0;
      }

      .post-card .date {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0.75rem 0 0;
        opacity: 0.7;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .hero h1 { font-size: 2.5rem; }
        .hero-doodle { display: none; }
        .featured-post { grid-template-columns: 1fr; }
        .featured-image { min-height: 180px; font-size: 3.5rem; }
        .featured-content { padding: 1.75rem; }
        .featured-content h3 { font-size: 1.4rem; }
        .posts-grid { grid-template-columns: 1fr; }
      }
    </style>
  </head>
  <body>
    <SkipLink />
    <Header />
    <main id="main-content">
      <section class="hero">
        <span class="hero-doodle d1">üöÄ</span>
        <span class="hero-doodle d2">üí°</span>
        <span class="hero-doodle d3">‚ö°</span>
        <span class="hero-doodle d4">üèéÔ∏è</span>

        <span class="hero-badge">üëã Hey, I'm Richard</span>
        <h1>
          I build <span class="highlight">products</span>,<br />
          experiment <span class="wiggle">ü§ñ</span> wildly with AI,<br />
          & chase <span class="highlight">lap times</span>
        </h1>
        <p class="hero-subtitle">
          Thoughts on PM craft, AI experiments, and occasionally going fast in circles.
          <span class="handwriting">No corporate fluff, promise.</span>
        </p>
        <a href="/blog" class="hero-cta">See what I've been thinking about ‚Üí</a>
      </section>

      <section class="topics">
        <span class="topic-tag">üéØ Product Management</span>
        <span class="topic-tag">ü§ñ AI & Automation</span>
        <span class="topic-tag">üèÅ Motorsport & Sim Racing</span>
      </section>

      {featuredPosts.length > 0 && (
        <section class="section">
          <div class="section-header">
            <h2>Latest Obsession</h2>
          </div>
          {featuredPosts.map((post) => (
            <article class="featured-post">
              <div class="featured-image">üß†</div>
              <div class="featured-content">
                {post.data.category && <span class="post-tag">{post.data.category}</span>}
                <h3><a href={`/blog/${post.id}/`}>{post.data.title}</a></h3>
                <p>{post.data.description}</p>
                <span class="read-time">‚òï <span class="handwriting">8 min read</span> ¬∑ grab a coffee</span>
              </div>
            </article>
          ))}
        </section>
      )}

      {posts.length > 0 && (
        <section class="section">
          <div class="section-header">
            <h2>Recent Ramblings</h2>
            <a href="/blog">See all posts ‚Üí</a>
          </div>
          <ul class="posts-grid">
            {posts.map((post) => (
              <li class="post-card">
                <a href={`/blog/${post.id}/`}>
                  {post.data.category && <span class="post-tag">{post.data.category}</span>}
                  <h3>{post.data.title}</h3>
                  <p class="description">{post.data.description}</p>
                  <p class="date">
                    <FormattedDate date={post.data.pubDate} />
                  </p>
                </a>
              </li>
            ))}
          </ul>
        </section>
      )}

      <section class="section">
        <NewsletterSignup />
      </section>
    </main>
    <Footer />
  </body>
</html>
